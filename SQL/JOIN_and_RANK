https://www.codewars.com/kata/58094559c47d323ebd000035/sql

Simple JOIN and RANK

WITH sales_table (id, name, sale_count)
AS (SELECT p.id,
       p.name,
       COUNT(s.sale)
FROM people p, sales s
WHERE p.id = s.people_id
GROUP BY p.id)


SELECT id,
       name,
       sale_count,
       RANK() OVER(ORDER BY sale_count) as sale_rank
FROM sales_table

# second solution

SELECT p.*,
       sc.sales_count as sale_count,
       RANK() OVER(ORDER BY sc.sales_count) as sale_rank
FROM people p
JOIN (SELECT people_id,
              COUNT(sale) as sales_count
          FROM sales
      GROUP BY people_id) sc
ON sc.people_id = p.id
